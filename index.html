<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>One-Stop Thematic News Dashboard</title>
<link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/3/38/News_icon.svg" />
<style>
  :root {
    --bg: #0b0f14;
    --text: #e5e7eb;
    --card-bg: #0d1320;
    --border: #1f2a3a;
    --accent: #93c5fd;
    --desc: #9ca3af;
    --error: #f87171;
  }
  [data-theme="light"] {
    --bg: #f9fafb;
    --text: #111827;
    --card-bg: #ffffff;
    --border: #e5e7eb;
    --accent: #2563eb;
    --desc: #4b5563;
    --error: #dc2626;
  }
  body{margin:0;font-family:system-ui,Arial;background:var(--bg);color:var(--text);transition:background .3s,color .3s}
  header{position:sticky;top:0;background:var(--card-bg);padding:1em;border-bottom:1px solid var(--border);display:flex;flex-direction:column;gap:.5em;z-index:1000}
  h1{margin:0;font-size:1.4em}
  .controls{display:flex;gap:.5em;flex-wrap:wrap;align-items:center}
  button,select,input{background:var(--border);color:var(--text);border:1px solid var(--border);padding:.4em .6em;border-radius:6px;cursor:pointer}
  button:hover,select:hover{background:var(--accent);color:#fff}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1em;padding:1em}
  .card{background:var(--card-bg);border:1px solid var(--border);border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);transition:background .3s,border .3s}
  .card h2{font-size:1em;padding:1em 1em .2em 1em;margin:0}
  ul{list-style:none;margin:0;padding:0}
  li{padding:1em;border-top:1px solid var(--border)}
  li:first-child{border-top:0}
  a{color:var(--accent);text-decoration:none;font-weight:600}
  a:hover{text-decoration:underline}
  .desc{color:var(--desc);font-size:.9em;margin-top:.4em}
  .error{color:var(--error);padding:0 1em 1em 1em;font-size:.9em}
  footer{text-align:center;color:var(--desc);padding:1em}
  /* progress bar */
  #progressBar{height:4px;width:0;background:var(--accent);transition:width .2s ease;position:absolute;top:0;left:0;}
  #spinner{display:none;position:absolute;top:6px;right:12px;width:18px;height:18px;border:2px solid var(--accent);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;}
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
</style>
</head>

<body>
<header>
  <div style="display:flex;justify-content:space-between;align-items:center;position:relative;">
    <h1>One-Stop Thematic News Dashboard</h1>
    <button id="themeToggle">ðŸŒ™ Toggle Theme</button>
    <div id="spinner"></div>
    <div id="progressBar"></div>
  </div>
  <div class="controls">
    <button id="refresh">â†» Refresh</button>
    <input id="search" placeholder="Filter headlines (e.g., AI, governance)" />
    <span id="timestamp" style="font-size:0.9em;color:var(--desc);margin-left:auto;"></span>
  </div>
</header>

<main class="grid" id="grid"></main>
<footer>Running locally via Node proxy â€“ Auto-refresh every hour</footer>

<script>
const FEEDS = [
  { name: "TechCrunch", url: "https://techcrunch.com/feed/" },
  { name: "WIRED", url: "https://www.wired.com/feed/rss" },
  { name: "Cointelegraph â€“ Tech & Crypto", url: "https://cointelegraph.com/rss" },
  { name: "ScienceDaily â€“ Top Science News", url: "https://www.sciencedaily.com/rss/top/science.xml" },
  { name: "VentureBeat â€“ AI", url: "https://venturebeat.com/category/ai/feed/" },
  { name: "Ars Technica", url: "https://feeds.arstechnica.com/arstechnica/index" },
  { name: "MIT Technology Review", url: "https://www.technologyreview.com/feed/" }
];

const grid=document.getElementById("grid");
const search=document.getElementById("search");
const timestamp=document.getElementById("timestamp");
const progressBar=document.getElementById("progressBar");
const spinner=document.getElementById("spinner");
const state={filter:""};

function esc(s){return (s||"").replace(/[&<>\"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));}
function strip(s){return s.replace(/<[^>]*>/g,"");}

async function loadFeed(feed){
  const url=`http://localhost:8080/feed?url=${encodeURIComponent(feed.url)}`;
  const r=await fetch(url);
  if(!r.ok)throw new Error(r.status);
  const text=await r.text();
  const xml=new DOMParser().parseFromString(text,"text/xml");
  const items=Array.from(xml.querySelectorAll("item")).slice(0,6).map(i=>({
    title:i.querySelector("title")?.textContent||"",
    link:i.querySelector("link")?.textContent||"",
    desc:i.querySelector("description")?.textContent||""
  }));
  return items;
}

function card(feed,items){
  const filtered=state.filter
    ? items.filter(i=>(i.title+i.desc).toLowerCase().includes(state.filter))
    : items;
  return `
  <section class="card">
    <h2>${feed.name}</h2>
    <ul>
      ${filtered.map(i=>`<li><a href="${i.link}" target="_blank">${esc(i.title)}</a><div class="desc">${esc(strip(i.desc)).slice(0,140)}...</div></li>`).join("")}
      ${!filtered.length?'<li class="desc">No matching headlines.</li>':""}
    </ul>
  </section>`;
}

async function refresh(){
  spinner.style.display="block";
  progressBar.style.width="0";
  grid.innerHTML="Loading feeds â€¦";
  const cards=[];
  let count=0;
  for(const f of FEEDS){
    try{
      const data=await loadFeed(f);
      cards.push(card(f,data));
    }catch(e){
      cards.push(`<section class="card"><h2>${f.name}</h2><div class="error">Could not load feed (${e.message})</div></section>`);
    }
    count++;
    progressBar.style.width=`${(count/FEEDS.length)*100}%`;
    await new Promise(r=>setTimeout(r,300)); // gentle delay
  }
  grid.innerHTML=cards.join("");
  const now=new Date();
  timestamp.textContent="Last updated: "+now.toLocaleTimeString();
  spinner.style.display="none";
  progressBar.style.width="100%";
  setTimeout(()=>progressBar.style.width="0",1000);
}

// ðŸ” Auto-refresh every hour
setInterval(refresh, 3600000);

// ðŸŒ“ Theme toggle
const themeToggle=document.getElementById("themeToggle");
const currentTheme=localStorage.getItem("theme")||"dark";
document.documentElement.setAttribute("data-theme",currentTheme);
themeToggle.textContent=currentTheme==="light"?"ðŸŒ™ Dark":"â˜€ï¸ Light";

themeToggle.onclick=()=>{
  const newTheme=document.documentElement.getAttribute("data-theme")==="light"?"dark":"light";
  document.documentElement.setAttribute("data-theme",newTheme);
  localStorage.setItem("theme",newTheme);
  themeToggle.textContent=newTheme==="light"?"ðŸŒ™ Dark":"â˜€ï¸ Light";
};

document.getElementById("refresh").onclick=refresh;
search.oninput=()=>{state.filter=search.value.toLowerCase();refresh();};
refresh();
</script>
</body>
</html>
